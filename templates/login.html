<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    {{template "tailwind_config"}}
    <title>Access Terminal | TITAN</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="//unpkg.com/alpinejs" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <style>
        body { background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; overflow: hidden; }
        .glass-panel { 
            background: var(--card); 
            backdrop-filter: blur(20px); 
            border: 1px solid var(--border); 
            box-shadow: var(--shadow); 
        }
        .input-field {
            background: var(--input-bg);
            border: 1px solid var(--border);
            color: var(--input-text);
            font-family: 'Inter';
            transition: all 0.3s;
        }
        .input-field:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(99,102,241,0.1);
            background: var(--input-bg);
            outline: none;
        }
        .submit-btn {
            background: var(--primary);
            color: white;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }
        .submit-btn:hover { background: #4f46e5; transform: translateY(-1px); 
            box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.3); }
        .submit-btn:active { transform: translateY(0); }
        .bg-grid { 
            background-size: 40px 40px; 
            background-image: linear-gradient(to right, rgba(255, 255, 255, 0.03) 1px, transparent 1px), linear-gradient(to bottom, rgba(255, 255, 255, 0.03) 1px, transparent 1px);
            mask-image: radial-gradient(circle at center, black, transparent 80%);
        }
        [x-cloak] { display: none !important; }
    </style>
    {{template "style"}}
</head>
<body class="flex items-center justify-center h-screen relative" x-data="{ mode: '{{.LoginMode}}' }">
    
    
    <!-- Background FX -->
    <div class="absolute inset-0 bg-grid pointer-events-none"></div>
    <div class="absolute w-[600px] h-[600px] bg-indigo-600/10 rounded-full blur-[120px] -top-20 -left-20 animate-pulse duration-[5000ms]"></div>
    <div class="absolute w-[400px] h-[400px] bg-purple-600/10 rounded-full blur-[100px] bottom-0 right-0"></div>

    <!-- Main Card -->
    <div class="glass-panel w-full max-w-sm p-8 rounded-3xl relative z-10 mx-4">
        
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-2xl font-black tracking-tight text-white mb-1" x-text="mode === 'login' ? 'TITAN NET' : mode === 'token' ? 'TOKEN ENTRY' : 'REDEEM ENTRY'">{{if eq .LoginMode "token"}}TOKEN ENTRY{{else if eq .LoginMode "redeem"}}REDEEM ENTRY{{else}}TITAN NET{{end}}</h1>
            <p class="text-gray-500 text-xs font-mono uppercase tracking-widest" x-text="mode === 'login' ? 'Authentication Required' : mode === 'token' ? 'API Token Access' : 'Redeem Access Code'">{{if eq .LoginMode "token"}}API Token Access{{else if eq .LoginMode "redeem"}}Redeem Access Code{{else}}Authentication Required{{end}}</p>
        </div>

        {{if .FlashMessage}}
        <div class="mb-4 rounded-xl border px-4 py-3 text-xs font-bold {{if eq .FlashType "success"}}bg-green-500/10 border-green-500/40 text-green-700 dark:text-green-300{{else if eq .FlashType "info"}}bg-blue-500/10 border-blue-500/40 text-blue-700 dark:text-blue-300{{else}}bg-red-500/10 border-red-500/40 text-red-700 dark:text-red-300{{end}}">
            {{.FlashMessage}}
        </div>
        {{end}}

        <!-- 1. LOGIN FORM -->
        <form x-show="mode === 'login'" action="/login" method="POST" class="space-y-4" data-disable-submit {{if ne .LoginMode "login"}}style="display:none"{{end}}>
            <input type="hidden" name="csrf_token" value="{{.CsrfToken}}">
            <div>
                <label class="block text-[10px] font-bold uppercase text-gray-500 mb-1 ml-1">Identity</label>
                <input name="username" class="input-field w-full px-4 py-3 rounded-xl text-sm font-bold placeholder-gray-600" placeholder="Username">
                <p class="text-[10px] text-gray-500 mt-1">Use the username you registered with.</p>
            </div>
            <div>
                <label class="block text-[10px] font-bold uppercase text-gray-500 mb-1 ml-1">Keyphrase</label>
                <input type="password" name="password" class="input-field w-full px-4 py-3 rounded-xl text-sm font-bold placeholder-gray-600" placeholder="••••••••">
                <p class="text-[10px] text-gray-500 mt-1">Passwords are case-sensitive.</p>
            </div>
            <button class="submit-btn w-full py-3.5 rounded-xl font-bold text-xs uppercase tracking-widest mt-2" data-loading-text="Signing in...">Enter System</button>
        </form>

        <!-- 2. TOKEN FORM (NEW) -->
        <form x-show="mode === 'token'" action="/token-login" method="POST" class="space-y-4" data-disable-submit {{if ne .LoginMode "token"}}style="display:none"{{end}}>
            <input type="hidden" name="csrf_token" value="{{.CsrfToken}}">
            <div>
                <label class="block text-[10px] font-bold uppercase text-gray-500 mb-1 ml-1">API Token</label>
                <input name="token" class="input-field w-full px-4 py-3 rounded-xl text-center font-mono tracking-wider text-sm font-bold placeholder-gray-600" placeholder="API-XXXX-XXXX">
            </div>
            <button class="submit-btn w-full py-3.5 rounded-xl font-bold text-xs uppercase tracking-widest mt-2 bg-green-600 hover:bg-green-500" data-loading-text="Validating...">Authenticate Token</button>
        </form>

        <!-- 3. REDEEM CODE FORM -->
        <form x-show="mode === 'redeem'" action="/redeem-login" method="POST" class="space-y-4" data-disable-submit {{if ne .LoginMode "redeem"}}style="display:none"{{end}}>
            <input type="hidden" name="csrf_token" value="{{.CsrfToken}}">
            <div>
                <label class="block text-[10px] font-bold uppercase text-gray-500 mb-1 ml-1">Redeem Code</label>
                <input name="redeem_code" class="input-field w-full px-4 py-3 rounded-xl text-center font-mono tracking-wider text-sm font-bold placeholder-gray-600" placeholder="RDM-XXXX-XXXX">
            </div>
            <button class="submit-btn w-full py-3.5 rounded-xl font-bold text-xs uppercase tracking-widest mt-2 bg-indigo-600 hover:bg-indigo-500" data-loading-text="Redeeming...">Redeem Access</button>
        </form>

        <!-- Footer Toggles -->
        <div class="mt-8 pt-6 border-t border-white/5 text-center flex justify-between items-center px-2">
            <a href="/register" class="text-xs text-gray-500 hover:text-white transition">No Account? <span class="text-indigo-400 font-bold">Initialize</span></a>
            
            <!-- Toggle Link -->
            <div class="flex items-center gap-3">
                {{if eq .LoginMode "login"}}
                <a href="/login?mode=token" @click.prevent="mode = 'token'" x-show="mode === 'login'" class="text-xs text-gray-400 hover:text-white transition font-mono border-b border-dashed border-gray-600 pb-0.5 hover:border-white">Use Token</a>
                <a href="/login?mode=redeem" @click.prevent="mode = 'redeem'" x-show="mode === 'login'" class="text-xs text-gray-400 hover:text-white transition font-mono border-b border-dashed border-gray-600 pb-0.5 hover:border-white">Login with Redeem Code</a>
                {{else if eq .LoginMode "token"}}
                <a href="/login" @click.prevent="mode = 'login'" x-show="mode === 'token'" class="text-xs text-gray-400 hover:text-white transition font-mono border-b border-dashed border-gray-600 pb-0.5 hover:border-white">Back to Login</a>
                <a href="/login?mode=redeem" @click.prevent="mode = 'redeem'" x-show="mode === 'token'" class="text-xs text-gray-400 hover:text-white transition font-mono border-b border-dashed border-gray-600 pb-0.5 hover:border-white">Login with Redeem Code</a>
                {{else}}
                <a href="/login" @click.prevent="mode = 'login'" x-show="mode === 'redeem'" class="text-xs text-gray-400 hover:text-white transition font-mono border-b border-dashed border-gray-600 pb-0.5 hover:border-white">Back to Login</a>
                <a href="/login?mode=token" @click.prevent="mode = 'token'" x-show="mode === 'redeem'" class="text-xs text-gray-400 hover:text-white transition font-mono border-b border-dashed border-gray-600 pb-0.5 hover:border-white">Use Token</a>
                {{end}}
            </div>
        </div>
    </div>

    <script>
        document.querySelectorAll('form[data-disable-submit]').forEach((form) => {
            form.addEventListener('submit', () => {
                const btn = form.querySelector('button[type="submit"], button:not([type])');
                if (!btn) return;
                const loadingText = btn.getAttribute('data-loading-text') || 'Processing...';
                btn.setAttribute('data-original-text', btn.textContent);
                btn.textContent = loadingText;
                btn.disabled = true;
                btn.classList.add('opacity-70', 'cursor-not-allowed');
            });
        });
    </script>
</body>
</html>
